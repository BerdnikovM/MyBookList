<?php
// Подключаем файл с соединением с базой данных
require_once 'db.php';

// Проверяем, был ли отправлен POST запрос
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Проверяем, была ли установлена переменная userEmail в POST запросе
    if (isset($_POST["userEmail"])) {
        // Получаем email пользователя из POST запроса
        $userEmail = $_POST["userEmail"];

        // Проверяем, какая кнопка была нажата и устанавливаем соответствующий флаг is_admin
        if (isset($_POST["makeAdmin"])) {
            $isAdmin = 1; // Сделать администратором
        } elseif (isset($_POST["makeUser"])) {
            $isAdmin = 0; // Сделать пользователем
        }

        // Пишем SQL запрос для обновления флага is_admin в таблице users
        $sql = "UPDATE users SET is_admin = ? WHERE email = ?";

        // Подготавливаем запрос
        $stmt = $conn->prepare($sql);

        // Проверяем, был ли успешно подготовлен запрос
        if ($stmt) {
            // Привязываем параметры и выполняем запрос
            $stmt->bind_param("is", $isAdmin, $userEmail);
            if ($stmt->execute()) {
                // Проверяем, было ли обновлено хотя бы одна строка в таблице
                if ($stmt->affected_rows > 0) {
                    // Успешно обновили роль пользователя
                    echo "Роль пользователя успешно обновлена.";
                } else {
                    // Если ни одна строка не была обновлена, значит пользователь с таким email не найден
                    echo "Пользователь с указанным email не найден.";
                }
            } else {
                // В случае ошибки
                echo "Произошла ошибка при обновлении роли пользователя.";
            }
            
            // Закрываем запрос
            $stmt->close();
        } else {
            echo "Ошибка подготовки запроса: " . $conn->error;
        }
    } else {
        echo "Email пользователя не был предоставлен.";
    }
} else {
    echo "Метод запроса должен быть POST.";
}
?>
